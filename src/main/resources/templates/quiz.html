<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz - Safe Browsing Mode</title>
    <!-- Use Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        /* Using a clean, modern font */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Fallback for Inter font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    </style>
</head>
<!--
  Body with the same soft gradient as the login page.
  Padding is added to give the main card space.
-->
<body class="bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 min-h-screen p-4 sm:p-8">

<!--
  Main quiz container.
  Centered with mx-auto, styled as a white card with shadow and rounded corners.
  max-w-3xl is used for a wider quiz format.
-->
<div class="container w-full max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-6 sm:p-8">

    <!-- Header Section -->
    <div class="text-center mb-6 border-b border-gray-200 pb-4">
        <h1 class="text-3xl font-bold text-gray-900">Quiz Active</h1>
        <p class="text-lg text-gray-500 mt-1">Safe Browsing Mode</p>
    </div>

    <!--
      Warning Message Block.
      Styled with high-visibility red colors, rounded, and an icon.
    -->
    <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-center gap-3" role="alert">
        <!-- Alert Icon -->
        <svg class="h-6 w-6 text-red-600 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126z" />
        </svg>
        <p class="font-medium">Do not switch tabs or exit fullscreen. If you do, the quiz will be submitted automatically.</p>
    </div>

    <!-- Quiz Form -->
    <form id="quizForm" th:action="@{/quiz/submit}" method="post" class="space-y-8">

        <!--
          Question Block (iterated).
          Each question is in its own lightly-styled sub-card.
        -->
        <div th:each="q,iter : ${questions}" class="q bg-gray-50 border border-gray-200 rounded-lg p-6 shadow-sm">

            <!-- Question Text -->
            <h3 th:text="${iter.index + 1} + '. ' + ${q.text}" class="text-xl font-semibold text-gray-800 mb-5">
                1. What is the capital of France?
            </h3>

            <!-- Options Container -->
            <div class="space-y-3">
                <!--
                  Option Item (iterated).
                  The entire label is clickable, with a hover effect.
                -->
                <div th:each="opt,idx : ${q.options}">
                    <label class="flex items-center p-3 w-full rounded-lg hover:bg-gray-200 transition duration-150 cursor-pointer border border-gray-300 bg-white">
                        <input type="radio"
                               th:name="${'q_' + q.id}"
                               th:value="${idx.index}"
                               class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300" />
                        <span th:text="${opt}" class="ml-3 text-gray-700 font-medium">Option text</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Action/Submit Button -->
        <div class="actions mt-8 pt-6 border-t border-gray-200 text-center">
            <button type="submit"
                    id="submitBtn"
                    class="inline-flex items-center justify-center bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-3 px-12 rounded-lg hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 shadow-lg text-lg">
                Submit Quiz
            </button>
        </div>
    </form>
</div>

<!--
  Anti-cheating script.
  This is retained from your original file, untouched.
-->
<script>
    (function(){
        const form = document.getElementById('quizForm');
        const submitBtn = document.getElementById('submitBtn');
        let submitted = false;

        function autoSubmit(reason){
            if (submitted) return;
            submitted = true;
            try { submitBtn.disabled = true; } catch(e){}
            // Append reason for server logs (optional hidden field)
            try {
                const hid = document.createElement('input');
                hid.type = 'hidden'; hid.name = 'autoReason'; hid.value = reason || 'unknown';
                form.appendChild(hid);
            } catch(e){}
            form.submit();
        }

        // Request fullscreen to discourage minimizing/switching
        async function enterFullscreen(){
            const el = document.documentElement;
            if (el.requestFullscreen) { await el.requestFullscreen(); }
            else if (el.webkitRequestFullscreen) { el.webkitRequestFullscreen(); }
        }
        enterFullscreen().catch(()=>{});

        // Detect visibility/tab switch and window blur
        document.addEventListener('visibilitychange', function(){
            if (document.hidden) {
                autoSubmit('visibilitychange');
            }
        });
        window.addEventListener('blur', function(){
            // if window lost focus, submit
            autoSubmit('window_blur');
        });

        // Detect exiting fullscreen
        function onFsChange(){
            const fs = document.fullscreenElement || document.webkitFullscreenElement;
            if (!fs) {
                autoSubmit('exit_fullscreen');
            }
        }
        document.addEventListener('fullscreenchange', onFsChange);
        document.addEventListener('webkitfullscreenchange', onFsChange);

        // Try to block some shortcuts and context menu
        window.addEventListener('contextmenu', e => e.preventDefault());
        window.addEventListener('keydown', function(e){
            // Block common shortcuts that could open new tabs/devtools
            if (e.ctrlKey || e.metaKey) {
                const k = e.key.toLowerCase();
                if (['t','n','w','r','p','s','o','l'].includes(k)) { e.preventDefault(); e.stopPropagation(); }
            }
            if (['F11','F12','PrintScreen'].includes(e.key)) { e.preventDefault(); e.stopPropagation(); }
        }, true);
    })();
</script>
</body>
</html>